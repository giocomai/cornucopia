<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A cornucopia is like a funnel that keeps on giving • cornucopia</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="A cornucopia is like a funnel that keeps on giving">
<meta name="description" content="Facilitate reporting on sponsored and organic activities on Facebook, Instagram, and LinkedIn (currently), estimate and visualise the result of marketing funnels (long term)">
<meta property="og:description" content="Facilitate reporting on sponsored and organic activities on Facebook, Instagram, and LinkedIn (currently), estimate and visualise the result of marketing funnels (long term)">
<meta property="og:image" content="https://giocomai.github.io/cornucopia/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">cornucopia</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9012</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="cornucopia-">cornucopia 
<a class="anchor" aria-label="anchor" href="#cornucopia-"></a>
</h1>
</div>
<!-- badges: start -->

<p>The goal of <code>cornucopia</code> is to facilitate reporting on sponsored and organic activities across various platforms, including Facebook, Instagram, and (to a lesser extent, due to lack of usable API) LinkedIn. Other networks may be added in the future.</p>
<div class="section level2">
<h2 id="why-call-it-cornucopia">Why call it <code>cornucopia</code>?<a class="anchor" aria-label="anchor" href="#why-call-it-cornucopia"></a>
</h2>
<p>For you all marketing folks, a cornucopia is like a funnel that keeps on giving. Also known as the “<a href="https://en.wikipedia.org/wiki/Cornucopia" class="external-link">horn of plenty</a>”, it’s basically really your wildest dream: a funnel that endlessly overflows with abundance.</p>
<p>Hence, the marketing slogan of <code>cornucopia</code> is:</p>
<p><strong><em>turn your every funnel into a cornucopia!</em></strong></p>
<p>The premise of <code>cornucopia</code> is that there’s plenty of small and big platforms that can be used to interact with the API (or to connect them to other data visualisation or data processing platforms) of big “social networks”/advertising platforms, but there’s really just a few open source packages in the <code>r</code> ecosystem openly available in this space. Some of these packages are of excellent quality, but overall there’s a steep learning curve when joining this space, and few tools enabling the beginner-intermediate users to look at these interrelated processes in an orderly fashion, or to facilitate some routine work for more advanced users.</p>
<p>Long term, this is the purpose of <code>cornucopia</code>, which is currently at an early stage of development.</p>
<p>As these so called “social networks” are all, at their core, marketing tools, throughout the package documentation I will use the language found on each platform’s website and use marketing terms by default. Needless to say, this can be used for reporting of non-profit websites, or for optimising conversions that are not purchases, etc.</p>
<p>Please enjoy <code>cornucopia</code> responsibly.</p>
</div>
<div class="section level2">
<h2 id="experimental-package-warning">Experimental package warning<a class="anchor" aria-label="anchor" href="#experimental-package-warning"></a>
</h2>
<p>Again, keep in mind that this is an incomplete and not fully tested package. It currently uses only API calls that <em>read</em> data, so it should be safe to use. But:</p>
<ul>
<li>it tries to cache data for efficency and speed, but the caching mechanisms may not always work, so make sure the extracted data are fit for purpose (more testing will be introduced)</li>
</ul>
<p>Also, the usual disclaimer: this free software comes with absolutely no warranty.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of cornucopia with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"giocomai/cornucopia"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="settings">Settings<a class="anchor" aria-label="anchor" href="#settings"></a>
</h2>
<p>You can you use <code><a href="reference/cc_set.html">cc_set()</a></code> to set start and end dates to be used by all other functions, as well as tokens, user identifiers, and caching preferences. You can provide as many or as few settings as you like. You can also pass the same as parameters to individual functions, without using <code><a href="reference/cc_set.html">cc_set()</a></code> at all.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://giocomai.github.io/cornucopia/">"cornucopia"</a></span><span class="op">)</span></span>
<span><span class="va">dates_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cc_set.html">cc_set</a></span><span class="op">(</span></span>
<span>  start_date <span class="op">=</span> <span class="st">"2023-01-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dates_l</span><span class="op">$</span><span class="va">start_date</span></span>
<span><span class="co">#&gt; [1] "2023-01-01"</span></span></code></pre></div>
<p>Here is a full list of parameters that can be set with <code><a href="reference/cc_set.html">cc_set()</a></code>:</p>
<p><code>start_date</code>, <code>end_date</code>, <code>fb_user_token</code>, <code>fb_page_token</code>, <code>fb_page_id</code>, <code>fb_business_id</code>, <code>fb_ad_account_id</code>, <code>fb_product_catalog_id</code>, <code>fb_user_id</code>, <code>ig_user_id</code>, <code>ga_email</code>, <code>ga_property_id</code></p>
</div>
<div class="section level2">
<h2 id="meta--facebook--instagram">Meta / Facebook / Instagram<a class="anchor" aria-label="anchor" href="#meta--facebook--instagram"></a>
</h2>
<p>In order to get data out of the Meta ecosystem through APIs, you will need to create an app following the <a href="https://developers.facebook.com/apps/create/" class="external-link">procedure on their Developer platform</a>.</p>
<p>You can then get your token from your <a href="https://developers.facebook.com/apps/" class="external-link">app page</a>, after adding the “Marketing API”. When you retrieve your token, you can select permissions: you probably want to include both “ads_read” and “read_insights”, as they are read-only and hence safe, while you probably don’t want to tick “ads_management”, unless you really know what you are doing.</p>
<p>You can also get a token with a different set of options for customisation, through the <a href="https://developers.facebook.com/tools/explorer/" class="external-link">Facebook’s Graph API explorer</a>.</p>
<p>Things, however, are not so easy, as you’ll need to go through additional steps to get long-lived tokens, Facebook page tokens, etc. - more details below.</p>
<p>Also, be mindful that the Meta APIs do not always return meaningful error messages, and the documentation has only few examples… as some queries work or not depending on the type of ad (its creatives/its format/etc.) or the type of organic post (is it a video? if so, is it a reel? etc.), there’s often some trial and error involved.</p>
<p>More broadly, whenever you get an error message that is unclear, think creatively about what could be wrong: has my token expired? did I exceed query limit? did I include a field which was not available for this endpoint? did I use the wrong identifier (e.g. a post id instead of a video id, or vice versa)?</p>
<div class="section level3">
<h3 id="organic---facebook-pages-and-access-tokens">Organic - Facebook pages and access tokens<a class="anchor" aria-label="anchor" href="#organic---facebook-pages-and-access-tokens"></a>
</h3>
<p>Data about Facebook pages need to be accessed with a Facebook <em>page</em> token, that is separate to the Facebook <em>user</em> token.</p>
<p>After retrieving the Facebook user token (as mentioned above, e.g. on the <a href="https://developers.facebook.com/tools/explorer/" class="external-link">Graph API explorer</a>), the first step is then to retrieve one’s own Facebook user id:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://giocomai.github.io/cornucopia/">"cornucopia"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/cc_set.html">cc_set</a></span><span class="op">(</span>fb_user_token <span class="op">=</span> <span class="st">"actual_token_here"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/cc_get_fb_user.html">cc_get_fb_user</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>And then use the Facebook user id to request all pages managed by that Facebook user, including the relevant Facebook page token:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_set.html">cc_set</a></span><span class="op">(</span>fb_user_id <span class="op">=</span> <span class="st">"actual_user_id_as_retrieved_with_cc_get_fb_user"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/cc_get_fb_managed_pages.html">cc_get_fb_managed_pages</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>It is this page token that can then be used to retrieve information about a given page.</p>
<p>You may hope that things would just work and that you’d see all your pages when you run <code><a href="reference/cc_get_fb_managed_pages.html">cc_get_fb_managed_pages()</a></code>. Things, however, may be not so simple, because of granular permissions. In other words, you need to explicitly grant permissions to access pages. As is characteristic of Facebook, they like to move settings around, but you should be able to add this permission from the <a href="https://developers.facebook.com/tools/explorer/" class="external-link">Graph Api Explorer</a> (for context, see also <a href="https://stackoverflow.com/a/77467164/4124601" class="external-link">this answer on StackOverflow</a>).</p>
<p>Select your app from the drop down menu, and then from the “User or Page” dropdown select: “Get page access token”. You will be asked to re-authenticate, and then you will be able to choose between:</p>
<ul>
<li>“Opt in to all current and future Pages”</li>
<li>or select from a list of your pages</li>
</ul>
<p>Then you will see you’ll have more permissions in the list, including</p>
<ul>
<li><code>pages_show_list</code></li>
<li><code>pages_read_engagement</code></li>
<li><code>ads_read</code></li>
<li><code>read_insights</code></li>
</ul>
<p>You probably want to add also <code>pages_read_user_content</code> in order to retrieve information about your own posts. If you are managing pages through business manager, this is probably not enough, as you will need to add also the <code>business_management</code> permission. Also consider that if you want to interact with the Instagram page associated with this page you will also need:</p>
<ul>
<li><code>instagram_basic</code></li>
<li><code>instagram_manage_insights</code></li>
</ul>
<p>Do remember to re-generate your token after adding permissions to actually get access.</p>
<p>You can run <code><a href="reference/cc_get_fb_managed_pages.html">cc_get_fb_managed_pages()</a></code> and get the token for all of your pages, or if you know what you’re looking for, you can get the token for a specific page as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_get_fb_managed_pages.html">cc_get_fb_managed_pages</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fb_page_token</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cc_get_fb_page_token.html">cc_get_fb_page_token</a></span><span class="op">(</span></span>
<span>  fb_user_id <span class="op">=</span> <span class="fu"><a href="reference/cc_get_fb_user.html">cc_get_fb_user</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  page_name <span class="op">=</span> <span class="st">"My example page"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>You should be now good to go.</p>
<p>But depending on how you created your token, you may well still be using a short-lived token. This may be fine, but perhaps you really want to have a long-lived token, so that you don’t need to constantly retrieve it again through web interfaces.</p>
<p>In order to get a long-lived user and page token, you need first to get a short-lived user token with the appropriate authorisations as described above, and then input your Facebook app id and secret, which you can retrieve from your <a href="https://developers.facebook.com/apps/" class="external-link">app page</a> page.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_get_fb_long_user_token.html">cc_get_fb_long_user_token</a></span><span class="op">(</span></span>
<span>  fb_user_token <span class="op">=</span> <span class="st">"your_short_term_token_here"</span>,</span>
<span>  fb_app_id <span class="op">=</span> <span class="st">"your_fb_app_id_here"</span>,</span>
<span>  fb_app_secret <span class="op">=</span> <span class="st">"your_fb_app_secret_here"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then you can use this long-lived user token to get a long-lived Facebook page access token. With the following function you will get a data frame with access tokens to all pages to which your short-lived tokens has access (you can select just a few or include all from the web intreface when you create the short-lived access token).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_get_fb_long_page_token.html">cc_get_fb_long_page_token</a></span><span class="op">(</span></span>
<span>  fb_user_id <span class="op">=</span> <span class="st">"your_fb_user_id_here"</span>,</span>
<span>  fb_user_token <span class="op">=</span> <span class="st">"your_long_term_token_here"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="a-word-of-caution-about-access-tokens">A word of caution about access tokens<a class="anchor" aria-label="anchor" href="#a-word-of-caution-about-access-tokens"></a>
</h4>
<p>Store these access tokens safely: while long-lived user access token expire after 60 days, long-lived page access tokens <em>do not expire</em>. We are solidly in password territory here: make sure you do not include these tokens in scripts you share, as they can be used to retrieve data, and, especially if you’re not really careful when you create them, do all sorts of other things, including posting to your page or creating ads. In theory, these permissions are super-granular, but in practice, especially for the pages you control through a Business Manager account, getting the right set of access in place is not straightforward (and maybe, not even possible). So eventually you may end up with access tokens with substantial access: treat them as you would treat secret passwords, and use them with care.</p>
<p>At this stage, all functions in this package use only read API, but the same access tokens may potentially be used for other APIs. So… take care.</p>
</div>
<div class="section level4">
<h4 id="using-the-keyring-package-for-storing-tokens-securely">Using the <code>keyring</code> package for storing tokens securely<a class="anchor" aria-label="anchor" href="#using-the-keyring-package-for-storing-tokens-securely"></a>
</h4>
<p>Throughout this readme and the documentation, reference is made to tokens as if they were directly included in scripts. As mentioned above, this is less than ideal, as this potentially implies having tokens stored as plain-text in scripts, as well as in local history files or server logs.</p>
<p>A convenient and much safer approach relies on the <a href="https://keyring.r-lib.org/index.html" class="external-link"><code>keyring</code> package</a>, which allows to store tokens using your operating system’s credential store.</p>
<p>Here is how a <code>keyring</code> based workflow would work.</p>
<p>First, go the <a href="https://developers.facebook.com/tools/explorer/" class="external-link">Graph API explorer</a> page and be ready to retrieve your Facebook user token, then run the following command to input it interactively and store it in your operating system’s keyring.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://giocomai.github.io/cornucopia/">"cornucopia"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://keyring.r-lib.org/" class="external-link">"keyring"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">keyring</span><span class="fu">::</span><span class="fu">key_set</span><span class="op">(</span>service <span class="op">=</span> <span class="st">"fb_user_token"</span><span class="op">)</span></span></code></pre></div>
<p>Notice that <code>fb_user_token</code> here is just the way I decide to name this in my local keyring: I can give this whatever name I like, or add the <code>username</code> argument if I plan to use more than one account.</p>
<p>Then I would usually need to add my Facebook user id. With the following command, I can retrieve and store the relevant id without even seeing it in the console.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">keyring</span><span class="fu">::</span><span class="fu">key_set_with_value</span><span class="op">(</span></span>
<span>  service <span class="op">=</span> <span class="st">"fb_user_id"</span>,</span>
<span>  password <span class="op">=</span> <span class="fu"><a href="reference/cc_get_fb_user.html">cc_get_fb_user</a></span><span class="op">(</span></span>
<span>    fb_user_token <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu">key_get</span><span class="op">(</span>service <span class="op">=</span> <span class="st">"fb_user_token"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In order to add safely your Facebook page token, you could then proceed as follows.</p>
<p>First, get the exact name or id of your Facebook page with:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_get_fb_managed_pages.html">cc_get_fb_managed_pages</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>And store the relevant page id with:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">keyring</span><span class="fu">::</span><span class="fu">key_set</span><span class="op">(</span></span>
<span>  service <span class="op">=</span> <span class="st">"fb_page_id"</span>,</span>
<span>  username <span class="op">=</span> <span class="st">"My example page"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then retrieve and store the Facebook page token in a single command:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">keyring</span><span class="fu">::</span><span class="fu">key_set_with_value</span><span class="op">(</span></span>
<span>  service <span class="op">=</span> <span class="st">"fb_page_token"</span>,</span>
<span>  username <span class="op">=</span> <span class="st">"My example page"</span>, <span class="co"># use your page name, if you manage more than one page</span></span>
<span>  password <span class="op">=</span> <span class="fu"><a href="reference/cc_get_fb_page_token.html">cc_get_fb_page_token</a></span><span class="op">(</span></span>
<span>    fb_user_id <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu">key_get</span><span class="op">(</span>service <span class="op">=</span> <span class="st">"fb_user_id"</span><span class="op">)</span>,</span>
<span>    fb_user_token <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu">key_get</span><span class="op">(</span>service <span class="op">=</span> <span class="st">"fb_user_token"</span><span class="op">)</span>,</span>
<span>    page_id <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu">key_get</span><span class="op">(</span></span>
<span>      service <span class="op">=</span> <span class="st">"fb_page_id"</span>,</span>
<span>      username <span class="op">=</span> <span class="st">"My example page"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now that you have stored these tokens in your local keyring, you can include at the beginning of your scripts something like this, without worring that your tokens will be shared involuntarily:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_set.html">cc_set</a></span><span class="op">(</span></span>
<span>  fb_user_id <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu">key_get</span><span class="op">(</span>service <span class="op">=</span> <span class="st">"fb_user_id"</span><span class="op">)</span>,</span>
<span>  fb_user_token <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu">key_get</span><span class="op">(</span>service <span class="op">=</span> <span class="st">"fb_user_token"</span><span class="op">)</span>,</span>
<span>  fb_page_token <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu">key_get</span><span class="op">(</span></span>
<span>    service <span class="op">=</span> <span class="st">"fb_page_token"</span>,</span>
<span>    username <span class="op">=</span> <span class="st">"My example page"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  fb_page_id <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu">key_get</span><span class="op">(</span></span>
<span>    service <span class="op">=</span> <span class="st">"fb_page_id"</span>,</span>
<span>    username <span class="op">=</span> <span class="st">"My example page"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For the sake of simplicity, you may find in this readme and elsewhere in the documentation example code that may suggest to include your tokens as plaintext: you now know that with <code>keyring</code> there is a better way. You have been warned.</p>
</div>
<div class="section level4">
<h4 id="once-youve-got-your-tokens">Once you’ve got your tokens<a class="anchor" aria-label="anchor" href="#once-youve-got-your-tokens"></a>
</h4>
<p>Now that you have these tokens, you probably want to set them and let them be used throughout the current session:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_set.html">cc_set</a></span><span class="op">(</span></span>
<span>  fb_page_token <span class="op">=</span> <span class="va">fb_page_token</span>,</span>
<span>  fb_page_id <span class="op">=</span> <span class="va">fb_page_id</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>(if you prefer, you can actively pass the token to each function call, or, you may rather prefer to use some other solution to make sure access tokens are not included in scripts, shared by mistake, etc. )</p>
<p>Good, now you have your Facebook Page Token, which you can use to get information about your page and posts, what do you do next? (also, be mindful that the same token can be used also to actually post on your page, so treat it with due caution and make sure it remains private)</p>
<p>Then, you probably want to get a list of all posts from your page.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posts_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cc_get_fb_page_posts.html">cc_get_fb_page_posts</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Yes, you probably have <em>a lot</em> of posts, but this function caches result by default, so you will have to do it only once, and then only newer posts will be retrieved, so it may be worth your time. If you don’t want to wait and just need a few posts, then you can retrieve only the most recent posts with something like:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posts_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cc_get_fb_page_posts.html">cc_get_fb_page_posts</a></span><span class="op">(</span></span>
<span>  max_pages <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  cache <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Which will retrieve the most recent 10 pages of posts (each page has 25 posts, so you do the math).</p>
<p>Besides Facebook post id, you already get some other basic information about each of the posts, namely:</p>
<p><code>created_time</code>, <code>id</code>, <code>permalink_url</code>, <code>message</code>, <code>full_picture</code>, <code>icon</code>, <code>is_hidden</code>, <code>is_expired</code>, <code>instagram_eligibility</code>, <code>is_eligible_for_promotion</code>, <code>promotable_id</code>, <code>is_instagram_eligible</code>, <code>is_popular</code>, <code>is_published</code>, <code>is_spherical</code>, <code>parent_id</code>, <code>status_type</code>, <code>story</code>, <code>subscribed</code>, <code>sheduled_publish_time</code>, <code>updated_time</code></p>
<p>But you probably want to know more. There’s a bunch of different things you can find out, and these vary depending on the type of post. But the most common next step is probably to get some more information about these posts with:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_get_fb_page_post_insights.html">cc_get_fb_page_post_insights</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>[to do]</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_get_fb_page_insights.html">cc_get_fb_page_insights</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_get_fb_page_video.html">cc_get_fb_page_video</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/cc_get_fb_video_insights.html">cc_get_fb_video_insights</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="meta-ads">Meta ads<a class="anchor" aria-label="anchor" href="#meta-ads"></a>
</h3>
<p>For the time being, <code>cornucopia</code> partly relies on <a href="https://github.com/daroczig/fbRads" class="external-link"><code>fbRads</code></a> to get data about sponsored campaigns and store them locally (long terms, all API calls will be done directly by <code>cornucopia</code> for consistency).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">token</span> <span class="op">&lt;-</span> <span class="st">"looooooooooong_string"</span></span>
<span></span>
<span><span class="va">account</span> <span class="op">&lt;-</span> <span class="st">"00000000000000000"</span></span>
<span></span>
<span><span class="fu">fbad_init</span><span class="op">(</span></span>
<span>  accountid <span class="op">=</span> <span class="va">account</span>,</span>
<span>  token <span class="op">=</span> <span class="va">token</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ads_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cc_get_fb_ads.html">cc_get_fb_ads</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Notice that if you ask for a lengthy period, you may hit the API query limit. The error message is however not helpful, as it apparently complains about <code>fields</code>. Just wait and try again after a few hours: all downloaded data are by default stored in a local folder and nothing will lost, queries will be made only for missing data.</p>
<p>If you’re hitting the API limits but what to proceed with writing your code as you wait, you can set the <code>only_cached</code> parameter to TRUE, so you can proceed with your analysis with the data you have until you’ll be able to download more data.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ads_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cc_get_fb_ads.html">cc_get_fb_ads</a></span><span class="op">(</span>only_cached <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Notice that you can customise the fields to retrieve and that not all fields can be asked at the same time. See the embedded list <code>cc_valid_fields_ad_insights</code> for list of valid fields, divided by broad categories (this subdivision has been made by the package author, not by Facebook itself). Caching of retrieved contents by type of fields will be addedt to future versions.</p>
<p>Not all ad-related information, however, can be retrieved through this endpoint.</p>
</div>
<div class="section level3">
<h3 id="creatives">Creatives<a class="anchor" aria-label="anchor" href="#creatives"></a>
</h3>
<p>For example, if you want details about the creatives used in an ad, you will first need to make queries to retrieve the <code>creative_id</code> associated with each ad (<a href="https://developers.facebook.com/docs/marketing-api/reference/adgroup/adcreatives/" class="external-link">see documentation of this endpoint</a>), and only then query the <a href="https://developers.facebook.com/docs/marketing-api/reference/ad-creative/" class="external-link">ad creative endpoint</a> to retrieve relevant information about the creative.</p>
<p>The first step of this process, i.e. retrieving <code>creative_id</code> can be achieved by passing a vector of <code>ad_id</code> to <code><a href="reference/cc_get_fb_ad_creatives_id.html">cc_get_fb_ad_creatives_id()</a></code>. Data will be cached locally by default, assuming creatives will mostly be added at the time when the ad is created.</p>
</div>
<div class="section level3">
<h3 id="action-breakdowns">Action breakdowns<a class="anchor" aria-label="anchor" href="#action-breakdowns"></a>
</h3>
<p>Here’s more interesting information, but also where caching gets trickier. But say, you are interested in <code>actions</code> by day and by ad, you can use <code>cc_get_fb_ad_actions_by_day</code>, passing to it a vector of <code>ad_id</code> (or <code>adset_id</code>, for that matter, the APIs don’t seem to mind), and you’ll get a daily breakdown.</p>
<p>You can get even more details: for example, do you want to know how many of those viewing your video ads had the sound on:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_get_fb_ad_actions_by_day.html">cc_get_fb_ad_actions_by_day</a></span><span class="op">(</span></span>
<span>  ad_id <span class="op">=</span> <span class="va">example_id</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"actions"</span>,</span>
<span>  action_breakdowns <span class="op">=</span> <span class="st">"action_video_sound"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">action_video_sound</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>For many such breakdowns, including this one, you get a meaningful breakdown only if your ad is relevant. For example, if the <code>example_id</code> above is of an ad that does not have any video, no information is returned. If you ask for <code>product_id</code> for an ad that is not based on catalogue, you won’t get anything. And so on.</p>
<p>See the <a href="https://developers.facebook.com/docs/marketing-api/insights/breakdowns/" class="external-link">official documentation</a> for details.</p>
<p>Caching does not really work with this function at this stage, as no consistent approach for updating cached data has been implemented, yet.</p>
</div>
<div class="section level3">
<h3 id="instagram">Instagram<a class="anchor" aria-label="anchor" href="#instagram"></a>
</h3>
<p>As for all things related to Meta’s API, you will need an app, and a valid token with all the needed permissions (not having the right permissions is the most frequent problem you’ll find, so when troubleshooting, take it from there).</p>
<p>So first set your <code>ig_user_id</code> and your token. If, as may well be the case, you don’t know your <code>ig_user_id</code> you can retrieve it with <code><a href="reference/cc_get_instagram_user_id.html">cc_get_instagram_user_id()</a></code>, as long as you have the <code>fb_page_id</code> of the Facebook page associated with the given Instagram account and <code>fb_user_token</code> (notice, the user token, not the page token). For reference, see also <a href="https://developers.facebook.com/docs/instagram-api/getting-started/" class="external-link">step 5 of this official guide</a>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_set.html">cc_set</a></span><span class="op">(</span></span>
<span>  ig_user_id <span class="op">=</span> <span class="st">"00000000000000000"</span>, <span class="co"># probably about 17 digits, not the legacy Instagram id</span></span>
<span>  fb_user_token <span class="op">=</span> <span class="st">"loooong_string"</span></span>
<span><span class="op">)</span> <span class="co"># the regular token, not the "page token"</span></span></code></pre></div>
<p>And you can get some basic information about your profile:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_get_instagram_user.html">cc_get_instagram_user</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Or just some specific fields:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_get_instagram_user.html">cc_get_instagram_user</a></span><span class="op">(</span>fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"username"</span>, <span class="st">"followers_count"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In order to get detailed information about each of your posts, you first need to know their <code>ig_media_id</code>. You can get this id for all of your posts with the following command:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_get_instagram_media_id.html">cc_get_instagram_media_id</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Be mindful that this may make many queries, as Instagram gives the result in batches of 25… if you have thousands of media, it may take some time. Data are however cached locally by default.</p>
<p>You can then pass the resulting <code>ig_media_id</code> to <code><a href="reference/cc_get_instagram_media.html">cc_get_instagram_media()</a></code> to get more information about a given Instagram post.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_get_instagram_media.html">cc_get_instagram_media</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Responses to <code><a href="reference/cc_get_instagram_media.html">cc_get_instagram_media()</a></code> are cached by default, and updated with decreasing frequency as posts get older (data are refreshed every day for the last week, once a week for the last month, once a month for the last year, once a year for previous years). As a consequence, you should mostly be able to keep this in scripts and rely on it to autoaupdate data without much delay.</p>
</div>
<div class="section level3">
<h3 id="retrieve-leads-from-meta-ads">Retrieve leads from Meta ads<a class="anchor" aria-label="anchor" href="#retrieve-leads-from-meta-ads"></a>
</h3>
<p>In order to retrieve leads from ad campaigns that rely on Meta’s native forms, you should make sure that your user token has the right permissions (it must include <code>leads_retrieval</code>).</p>
<p>Then you must get the identifier of your lead form: you can see it when you create it, when you download leads as a csv from a single ad, or from the dedicated section in the ads manager. You should be aware that only the form id matters; all leads from that form will be retrieved, no matter the the ad set or ad in which it is included (refernce to adset and ad are however included in the returned along with the data).</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_get_fb_leads.html">cc_get_fb_leads</a></span><span class="op">(</span>form_id <span class="op">=</span> <span class="st">"insert_form_id_here"</span><span class="op">)</span></span></code></pre></div>
<p>You can of course feed these data into your own workflows, e.g. uploading them to Google Sheets with <a href="https://github.com/tidyverse/googlesheets4/" class="external-link"><code>googlesheets4</code></a>, and even do this recurrently, by running e.g. the script every hour as faciliated by packages such as <a href="https://github.com/bnosac/cronR" class="external-link"><code>cronR</code></a> or <a href="https://github.com/bnosac/taskscheduleR" class="external-link"><code>taskscheduleR</code></a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="linkedin">LinkedIn<a class="anchor" aria-label="anchor" href="#linkedin"></a>
</h2>
<p>LinkedIn does not allow for exporting statistics about pages or ads systematically, if not by using one of a very small number of ridiculously expensive third party services.</p>
<p>This complicated the independent processing of the data, as well as their inclusion in third party dashboard.</p>
<p>To deal with both of these issues, <code>cornucopia</code> includes a set of functions that facilitates:</p>
<ul>
<li>processing files with statistics exported from LinkedIn</li>
<li>store them locally in a consistent manner</li>
<li>keep them updated in a set of Google Sheets, in order to facilitate their integration with services such as Looker Studio</li>
</ul>
<p>The user just needs to download relevant files and store them in a folder, without paying attention to anything else, really. Files for more than one page can be included in the same folder and no special attention needs to be dedicated to the time period included: <code>cornucopia</code> will always strive to include data for the longest possible period, always preferring the most recent data available. For this reason, it is usually easiest to export data about the last 365 days, and let this package deal with the rest.</p>
<p>Export files for all sorts of a statics from your LinkedIn page. They will have file names such as “pagename_followers_1684688073420.xls”. Throw all of them in a folder, that we’ll call “LinkedIn_stats”.</p>
<p>You can then retrieve some basic information about these files using:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_get_linkedin_stats_files.html">cc_get_linkedin_stats_files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"LinkedIn_stats"</span><span class="op">)</span></span></code></pre></div>
<p>This allows to see when a file was exported, what is the name of the page, and what type of statistics it includes: all of this information can be gathered from the file name.</p>
<p>Each of the statistics types exported from LinkedIn has its own data format, and indeed there is little consistency in these files, if not for the ridiculous insistence on including dates in the ridiculous US date format (month-day-year), no matter where you are in the world.</p>
<p>Anyway… we can now move on to the specific functions for each type of statistics. The following functions parse all relevant files and merge the data preferring the most recently downloaded data over older files (this may be irrelevant in many cases, but may well have some impact in statistics associated with a given post).</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">followers_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cc_get_linkedin_stats_followers.html">cc_get_linkedin_stats_followers</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="st">"LinkedIn_stats"</span>,</span>
<span>  page <span class="op">=</span> <span class="st">"example-page"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Once we have these data, we can of course process them as we usually would. But for the sake of this post, we are imagining a workflow that requires us to upload these files to a Google Sheet, in order to facilitate data retrieval through Google Looker Studio.</p>
<p>We can do this manually, but, of course, we’d much rather use a set of convenience functions that will process data and upload them automatically to the same Google Sheet, updating the dataset if one was previously uploaded.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_drive_upload_linkedin_stats_followers.html">cc_drive_upload_linkedin_stats_followers</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="st">"LinkedIn_stats"</span>,</span>
<span>  page_name <span class="op">=</span> <span class="st">"example-page"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/cc_drive_upload_linkedin_stats_content.html">cc_drive_upload_linkedin_stats_content</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="st">"LinkedIn_stats"</span>,</span>
<span>  page_name <span class="op">=</span> <span class="st">"example-page"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/cc_drive_upload_linkedin_stats_visitors.html">cc_drive_upload_linkedin_stats_visitors</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="st">"LinkedIn_stats"</span>,</span>
<span>  page_name <span class="op">=</span> <span class="st">"example-page"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="google-analytics">Google Analytics<a class="anchor" aria-label="anchor" href="#google-analytics"></a>
</h2>
<p>Only the most tentative integration with Google Analytics has so far been implemented, relying on <a href="https://cran.r-project.org/web/packages/googleAnalyticsR/index.html" class="external-link">googleAnalyticsR</a>.</p>
<p>If you are interested in the ratio (possibly, calculated as a rolling average), consider something such as the following.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cc_set.html">cc_set</a></span><span class="op">(</span>ga_email <span class="op">=</span> <span class="st">"example@example.com"</span>,</span>
<span>       ga_property_id <span class="op">=</span> <span class="fl">123456789</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/cc_get_ga_event_ratio.html">cc_get_ga_event_ratio</a></span><span class="op">(</span>events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"session_start"</span>, <span class="st">"purchase"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/cc_get_ga_event_ratio.html">cc_get_ga_event_ratio</a></span><span class="op">(</span>events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"session_start"</span>, <span class="st">"purchase"</span><span class="op">)</span>,</span>
<span>                      rolling <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>This is a quick implementation, and further convenience functions based on <a href="https://cran.r-project.org/web/packages/googleAnalyticsR/index.html" class="external-link">googleAnalyticsR</a> may be introduced, including local caching.</p>
</div>
<div class="section level2">
<h2 id="disclaimer">Disclaimer<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
</h2>
<p>I despise ad-tech, but I’ve got work to do.</p>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p><code>cornucopia</code> is released under a MIT license.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing cornucopia</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Giorgio Comai <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0002-0515-9542" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Giorgio Comai.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
